# ライブ運用マニュアル — LiveVJ

## 1. セットアップ手順

1. **Chrome 最新版** を用意する。
2. **nanoKONTROL2** を USB で接続する。
3. プロジェクトを **ローカルサーバ** で起動する。
   ```bash
   cd liveVj && python3 -m http.server 8000
   ```
4. ブラウザで **http://localhost:8000/** を開く。
5. コンソールに `✓ MIDI connected: nanoKONTROL2` が出れば MIDI 接続完了。出ない場合はキーボード操作で利用可能。

## 2. MIDI マッピング表

### フェーダー（CC 0–7）

| 番号 | CC  | 内容           | 範囲・備考                    |
|------|-----|----------------|-------------------------------|
| 1    | 0   | 粒子数         | 10,000 ～ 500,000（対数）     |
| 2    | 1   | 彩度           | 0.0 ～ 1.0                    |
| 3    | 2   | 明度           | 0.2 ～ 1.0                    |
| 4    | 3   | 色相           | 0.0 ～ 1.0                    |
| 5    | 4   | 回転速度 X     | -0.01 ～ 0.01 rad/frame      |
| 6    | 5   | 回転速度 Y     | -0.01 ～ 0.01 rad/frame      |
| 7    | 6   | 色変化速度     | 0.5 ～ 2.0 倍                 |
| 8    | 7   | ノイズ強度     | 0.0 ～ 1.0                    |

### ノブ（CC 16–23）

| 番号 | CC  | 内容           | 範囲                    |
|------|-----|----------------|-------------------------|
| 1    | 16  | ブルーム強度   | 0.0 ～ 2.0              |
| 2    | 17  | トレイル強度   | 0.0 ～ 1.0              |
| 3    | 18  | ワープ強度     | 0.0 ～ 0.3              |
| 4    | 19  | グリッチ強度   | 0.0 ～ 1.0              |
| 5    | 20  | 色収差強度     | 0.0 ～ 5.0 ピクセル     |

### ボタン S（CC 32–39）

| 番号 | CC  | 内容                          |
|------|-----|-------------------------------|
| S1   | 32  | エフェクトセット A トグル     |
| S2   | 33  | エフェクトセット B トグル     |
| S3   | 34  | レイヤー 1 ON/OFF             |
| S4   | 35  | レイヤー 2 ON/OFF             |
| S5   | 36  | レイヤー 3 ON/OFF             |
| S6   | 37  | プリセット 1 呼び出し         |
| S7   | 38  | プリセット 2 呼び出し         |
| S8   | 39  | 全リセット                    |

- **エフェクトセット A**: ブルーム ＋ トレイル ＋ ワープ  
- **エフェクトセット B**: グリッチ ＋ 色収差  

## 3. キーボード操作（MIDI 未接続時）

| キー       | 機能                         |
|------------|------------------------------|
| Q / A      | 粒子数 増 / 減               |
| W / S      | 彩度 増 / 減                 |
| E / D      | 明度 増 / 減                 |
| R / F      | 色相 増 / 減                 |
| 1          | エフェクトセット A トグル   |
| 2          | エフェクトセット B トグル   |
| 3          | 全エフェクト OFF             |
| Cmd+1/2/3  | 現在状態をスロット 1/2/3 に保存 |
| Shift+1/2/3| スロット 1/2/3 から読み込み  |
| Cmd+R      | 全リセット                   |
| H          | デバッグ UI 表示切替         |

## 4. トラブルシューティング

- **「WebGL2 未対応」**: Chrome を使用し、ハードウェアアクセラレーションを有効にしてください。
- **MIDI が検出されない**: Chrome で MIDI の権限を許可しているか確認。別アプリが nanoKONTROL2 を占有していないか確認。
- **FPS が落ちる**: 粒子数（フェーダー 1）を下げる。エフェクトセット A/B を OFF にする。解像度や外部ディスプレイ数を減らす。
- **プリセットが読み込めない**: `presets.json` がルートにあり、同じオリジンで配信されているか確認。

## 5. パフォーマンスチューニングのヒント

- 目標 60fps を切る場合、品質マネージャが自動で粒子数・エフェクトを削減します。
- ブルームは負荷が高いため、必要時のみエフェクト A を ON にすると安定しやすいです。
- トレイル・ワープは FPS 低下時に自動で OFF になることがあります。

## 6. プリセット作成ガイド

1. 画面上でフェーダー・ノブ・ボタンで好みの状態にする。
2. **Cmd+1**（または 2, 3）で現在の状態をスロットに保存。
3. 別シーンでは **Shift+1**（または 2, 3）でそのスロットを呼び出し。
4. ファイルベースのプリセットは `presets.json` を編集し、`particles` / `effects` / `layers` の構造を参考にしてください。
